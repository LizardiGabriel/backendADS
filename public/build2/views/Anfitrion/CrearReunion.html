<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeMeet - Crear Reunión</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" href="../../css/app.css">
    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@200..800&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

    <!--Formulario-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>
    <nav class="sidebar close">
        <div class="header">
            <div class="sidebar__marca">
                <div class="sidebar__imagen">
                    <img src="../../img/BeeMeet2.png" alt="Logo">
                </div>
                <div class="sidebar__texto">
                    <p class="sidebar__texto-marca">BeeMeet</p>
                    <p class="sidebar__texto-slogan">Anfitrión</p>
                </div>
            </div>
            <div class="sidebar__arrow toggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill=#FFFFFF
                    class="bi bi-arrow-right-short" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8" />
                </svg>
            </div>
        </div>
        <div id="sidebar__list" class="sidebar__menu" style="grid-template-columns:repeat(3, 6rem)">
            <div id="" class="sidebar__menu-option option__active">
                <div class="icon" title="Usuarios">
                    <svg fill="#F9D8C1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;"
                        xml:space="preserve">
                        <path class="st0"
                            d="M256,362.7c-47.1,0-85.3-38.2-85.3-85.3S208.9,192,256,192s85.3,38.2,85.3,85.3S303.1,362.7,256,362.7z
                            M384,448c0-35.3-28.7-64-64-64H192c-35.3,0-64,28.7-64,64v64h256V448z M384,170.7c-47.1,0-85.3-38.2-85.3-85.3S336.9,0,384,0
                            s85.3,38.2,85.3,85.3S431.1,170.7,384,170.7z M128,170.7c-47.1,0-85.3-38.2-85.3-85.3S80.9,0,128,0s85.3,38.2,85.3,85.3
                            S175.1,170.7,128,170.7z M128,277.3c0-31.5,11.7-61.9,32.8-85.3H64c-35.3,0-64,28.7-64,64v64h135.4C130.5,306.3,128,291.9,128,277.3
                            z M376.6,320H512v-64c0-35.3-28.7-64-64-64h-96.8C382.6,226.7,392.4,275.9,376.6,320L376.6,320z" />
                    </svg>

                </div>
                <div>
                    <p class="option__text">Consultar Reunión</p>
                </div>
            </div>
            <div id="" class="sidebar__menu-option">
                <div class="icon" title="Reuniones">
                    <svg fill="#F9D8C1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 128 128" style="enable-background:new 0 0 128 128;" xml:space="preserve">
                        <g>
                            <ellipse class="st0" cx="23.2" cy="47.4" rx="7.8" ry="7.8" />
                            <path class="st0" d="M37.4,97.5h-9.5c0,0-0.5,0-0.9,0c-4.3-0.4-8-3.5-9.1-7.8l-6.5-24.2c-0.4-1.4-1.8-2.1-3-1.8
                       c-1.4,0.4-2.1,1.8-1.8,3L13,90.9c1.7,6.3,7,10.9,13.5,11.4c0.6,0.1,1.3,0.1,1.3,0.1h9.5c1.4,0,2.4-1.1,2.5-2.5
                       C39.8,98.5,38.8,97.5,37.4,97.5z" />
                            <path class="st0" d="M48.6,83.9h-13c-0.3-4.9-1.1-9.8-2.3-14.7c-0.1-0.4-0.4-1.4-0.4-1.5c-1.7-6.3-7.7-10.3-14-9.7
                       c0,0-0.8,0.1-1,0.1c-2.3,0.6-3.7,3-3.1,5.4l6.7,24.9c0.7,2.8,3.1,4.9,6.1,5.1h0.6h15.5v17.8c0,2.7,2.1,4.9,4.9,4.9
                       c2.7,0,4.9-2.1,4.9-4.9V88.8c0-1.3-0.5-2.5-1.5-3.4C51.1,84.4,49.8,83.9,48.6,83.9z" />
                        </g>
                        <g>
                            <ellipse class="st0" cx="104.4" cy="47.5" rx="7.8" ry="7.8" />
                            <path class="st0"
                                d="M90.2,97.5h9.5c0,0,0.5,0,0.9,0c4.3-0.4,8-3.5,9.1-7.8l6.5-24.2c0.4-1.4,1.8-2.1,3-1.8c1.4,0.4,2.1,1.8,1.8,3
                       l-6.4,24.2c-1.7,6.3-7,10.9-13.5,11.4c-0.6,0.1-1.3,0.1-1.3,0.1h-9.5c-1.4,0-2.4-1.1-2.5-2.5C87.8,98.5,88.9,97.5,90.2,97.5z" />
                            <path class="st0" d="M79,83.9h13c0.3-4.9,1.1-9.8,2.3-14.7c0.1-0.4,0.4-1.4,0.4-1.5c1.7-6.3,7.7-10.3,14-9.7c0,0,0.8,0.1,1,0.1
                       c2.3,0.6,3.7,3,3.1,5.4L106,88.4c-0.7,2.8-3.1,4.9-6.1,5.1h-0.6H83.9v17.8c0,2.7-2.1,4.9-4.9,4.9s-4.9-2.1-4.9-4.9V88.8
                       c0-1.3,0.5-2.5,1.5-3.4C76.5,84.4,77.8,83.9,79,83.9z" />
                        </g>
                        <rect x="38.8" y="70.8" class="st0" width="50.6" height="6" />
                        <circle class="st0" cx="64.1" cy="43.2" r="7.2" />
                        <path class="st0" d="M52.5,67.9v-4.3h-0.1c0-0.5,0.4-0.9,0.9-0.9s0.9,0.4,0.9,0.9v4.3h19.9v-4.3H74c0-0.5,0.4-0.9,0.9-0.9
                   s0.9,0.4,0.9,0.9v4.3H82v-6.1c0-5-4-9-9-9H55c-5,0-9,4-9,9v6.1H52.5z" />
                    </svg>

                </div>
                <div>
                    <p class="option__text">Agendar Reunión</p>
                </div>
            </div>
            <div id="" class="sidebar__menu-option">
                <div class="icon" title="Salas">

                    <svg class="" aria-hidden="true" fill="#F9D8C1" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M4 4a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2v14a1 1 0 1 1 0 2H5a1 1 0 1 1 0-2V5a1 1 0 0 1-1-1Zm5 2a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H9Zm5 0a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1Zm-5 4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H9Zm5 0a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1h-1Zm-3 4a2 2 0 0 0-2 2v3h2v-3h2v3h2v-3a2 2 0 0 0-2-2h-2Z"
                            clip-rule="evenodd" />
                    </svg>

                </div>
                <div>
                    <p class="option__text">Salas</p>
                </div>
            </div>
            <div class="option__indicator"></div>
        </div>
    </nav>

    <div id="blur" class=""></div>

    <header>
        <nav class="navbar navbar-expand navbar-dark">
            <div class="container-fluid">
                <a id="navbar-img" class="navbar-brand" href="#">
                    <img id="navbar-imgs" src="../../img/BeeMeet2.png" alt="Logo">
                </a>
                <div class="navbar-nav ms-auto">
                    <div class="nav-item dropdown">
                        <button class="navbar__profile-container nav-link profile-button" onclick="toggleMenu()">
                            <div id="user-menu" style="display: none;">
                                <a href="#">Mis datos</a>
                                <a href="#">Cerrar sesión</a>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="contenidoPrincipal">
        <div class="crearReunion">
            <h1 class="crear__titulo">Gestionar reuniones</h1>
            <button class="actualizarBoton" onclick="obtenerReuniones()">Actualizar Reuniones</button>
        
            <div class="div__reuniones" id="divReuniones" class="cardszzz"></div>
        
            <h1 class="crear__subtitulo">Crear Reunion</h1>
            <form id="formCrearReunion">
                <label class="crear__label" for="titulo_reunion">Titulo de la reunión:</label>
                <input class="form-control form-control-lg" type="text" id="titulo_reunion" name="titulo_reunion" required>
                <br>
                <label class="crear__label" for="descripcion_reunion">Descripción de la reunión:</label>
                <input class="form-control form-control-lg" type="text" id="descripcion_reunion" name="descripcion_reunion" required>
                <br>
                <div class="col-md-6">
                    <label class="crear__label" for="fecha_reunion">Fecha de inicio de la reunión:</label>
                    <input class="form-control form-control-lg" type="date" id="fecha_reunion" name="fecha_reunion" required>
                </div>
                <br>
                <div class="col-md-6">
                    <label>Hora de inicio de la reunion</label>
                    <input type="text" class="form-control form-control-lg clockpicker" data-placement="top"
                        data-align="top" data-autoclose="false" data-format="HH:ii" max="22:30" min="10:00" step="1"
                        required>

                    <div class="invalid-feedback">
                        Ingrese un horario.
                    </div>
                </div>
                <br>
                <div class="col-md-6">
                    <label>Hora de fin de la reunion</label>
                    <input type="text" class="form-control form-control-lg clockpicker" data-placement="top"
                        data-align="top" data-autoclose="false" data-format="HH:ii" max="22:30" min="10:00" step="1"
                        required>

                    <div class="invalid-feedback">
                        Ingrese un horario.
                    </div>
                </div>
                <br>
                <div class="form-group">
                    <label class="crear__label" for="isRepetible">¿Es repetible?</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="isRepetible inlineCheckbox1" name="isRepetible" required>
                        <label class="form-check-label" for="inlineCheckbox1">Sí</label>
                      </div>
                </div>
                <br>
                <table id="tablaFechasRepetir">
                    <tr>
                        <th>Fecha</th>
                        <th>accion</th>
                    </tr>
                </table>
                <button class="addFecha__boton" id="btnAgregarFecha" onclick="agregarFecha()">Agregar Fecha</button>
                <br>
        
                <div class="form-row"></div>
                    <label for="nombreSala">Nombre de la sala:</label>
                    <select class="__opciones custom-select form-control-lg" id="nombreSala" name="nombreSala" required>
                        <option value="1">Sala 1</option>
                        <option value="2">Sala 2</option>
                        <option value="3">Sala 3</option>
                    </select>
                <div class="button__container">
                    <button class="button__submit" type="button" onclick="crearReunion()">Crear Reunión</button>
                </div>
        </div>
            </form>
        </div>
    </main>

    <footer class="footer">
        <div class="contenedor">
            <div class="beemeet">
                <div class="beemeet__logo">
                    <img src="../../img/BeeMeet2.png" alt="Logo Beemeet">
                </div>
                <h3 class="beemeet__titulo">BeeMeet</h3>
            </div>
            <div class="usernames">
                <p>Equipo de BeeCoders:</p>
                <div class="usernames__container">
                    <div class="usernames1">
                        <p>@RafaElJefe</p>
                        <p>@DianaLaConsejera</p>
                        <p>@CesarLaLechugaFresca</p>
                        <p>@LizardiElGranProgramador</p>
                        <p>@DaniBoyElFrontProgramador</p>
                        <p>@DiegoElCPC</p>
                    </div>
                    <div class="usernames2">
                        <p>@RorroElMusculoso</p>
                        <p>@LeoElCuadrado</p>
                        <p>@ToñitoElChispas</p>
                        <p>@AdoElBienPortado</p>
                        <p>@VallejoLaCreativa</p>
                        <p>@SaulElChambeador</p>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <p class="copyright">Copyright. Todos los derechos reservados. BeeMeet © 2024</p>
    </footer>

    <script src="../../js/header.js"></script>
    <script src="../../js/sidebar.js"></script>
    <script src="../../js/clockpicker.js"></script>
    <script src="../../js/plantilla-formularios.js"></script>

    <script>
        window.onload = function () {
            obtenerReuniones();
            obtenerSalas();
        }

        function obtenerSalas() {
            fetch('salas')
                .then(response => response.json())
                .then(salas => {
                    console.log('salas:', salas);
                    const selectSala = document.getElementById('nombreSala');
                    selectSala.innerHTML = '';
                    salas.forEach(sala => {
                        const option = document.createElement('option');
                        option.value = sala.id_sala;
                        option.textContent = sala.nombre_sala;
                        selectSala.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function eliminarFila(boton) {
            const fila = boton.parentNode.parentNode;
            fila.parentNode.removeChild(fila);
        }

        function agregarFecha() {
            const tablaFechasRepetir = document.getElementById('tablaFechasRepetir');
            const fila = document.createElement('tr');
            fila.innerHTML = `
                <td><input type="date" name="fechaRepetir" required></td>
                <td><button onclick="eliminarFila(this)">Eliminar</button></td>
            `;
            tablaFechasRepetir.appendChild(fila);
        }

        function obtenerReuniones() {
            fetch('reuniones')
                .then(response => response.json())
                .then(reuniones => {
                    console.log('reuniones xd:', reuniones);

                    const divReunion = document.getElementById('divReuniones');
                    divReunion.innerHTML = '';

                    reuniones.forEach(reunion => {
                        const card = document.createElement('div');
                        card.classList.add('card');

                        const emailDiv = 'correoInv-' + reunion.id_reunion;
                        const acompanantesDiv = 'acompanantesInv-' + reunion.id_reunion;

                        card.innerHTML = `
                        
                            <h4><b>Reunion id: </b>${reunion.id_reunion}</h4>

                            <div class="asunto">
                            <h4><b>Asunto: </b></h4>
                            <p>${reunion.titulo_reunion}</p>
                            </div>


                            <h4><b>Fechas: </b>${reunion.numRepeticion}</h4>
                            <ul class="fechas">${reunion.fechasRepeticion.map(fecha =>
                            `<li>${fecha.id_repeticion} , 
                                ${fecha.fecha_repeticion}, ${fecha.hora_inicio_repeticion} - ${fecha.hora_fin_repeticion},
                                ${fecha.estatus_repeticion}</li>
                                    
                            `).join('')}
                            </ul>


                            <h4><b>Descripción</b></h4>
                            <br/>
                            <p>${reunion.descripcion_reunion}</p>
                            <br/>
                            <h4><b>id Sala: </b>${reunion.id_sala}</h4>
                            <br/>

                            <h4><b>Lista de los correos de los invitados: - acompañantes disponibles</b></h4>
                            
                            <ul>${reunion.infoInvitados.map(info =>
                            `<li>${info.correo_invitado} - ${info.numero_colados}</li>
                            `).join('')}
                            </ul>
                            

                            <button onclick="detallesReunion(${reunion.id_reunion})">Detalles</button>
                            <button onclick="mostrarFormulario(${reunion.id_reunion})">Crear Invitación</button>
                            <button onclick="eliminarReunion(${reunion.id_reunion})">Eliminar</button>

                            <div class="form__inv" id="formulario-${reunion.id_reunion}" style="display:none">
        <h4 class="text-center">Formulario de Invitación</h4>
        <form id="form-${reunion.id_reunion}">
            <div class="form-group has-validation">
                <label for="correos">Correo de invitación:</label><br>
                <input id="${emailDiv}" name="correos" rows="4" cols="50" type="text" class="form-control form-control-lg" placeholder="Ingrese su correo"
                    required>

                <div class="invalid-feedback">
                    Ingrese su correo
                </div>
            </div>

            <div class="form-group has-validation">
                <label for="acompanantes">Número de acompañantes:</label><br>
                <input id="${acompanantesDiv}" name="acompanantes" required name="correos" rows="4" cols="50" type="number" class="form-control form-control-lg" placeholder="Ingrese su correo"
                    required>

                <div class="invalid-feedback">
                    Ingrese el número de acompanantes
                </div>
            </div>

            <button class="boton__inv" type="button" onclick="enviarInvitacion(${reunion.id_reunion})">Añadir</button>
        </form>
    </div>

                            `;
                        divReuniones.appendChild(card);
                    });

                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function mostrarFormulario(idReunion) {
            const formulario = document.getElementById(`formulario-${idReunion}`);
            formulario.style.display = 'block';
        }




        function crearReunion() {


            const titulo_reunion = document.getElementById('titulo_reunion').value;
            const descripcion_reunion = document.getElementById('descripcion_reunion').value;
            const fecha_reunion = document.getElementById('fecha_reunion').value;
            const hora_inicio_reunion = document.getElementById('hora_inicio_reunion').value;
            const hora_fin_reunion = document.getElementById('hora_fin_reunion').value;
            const isRepetible = document.getElementById('isRepetible').checked;
            const nombreSala = document.getElementById('nombreSala').value;

            const fechasRepetir = [];
            document.querySelectorAll('input[name="fechaRepetir"]').forEach(input => {
                fechasRepetir.push(input.value);
            });

            const envJson = {
                titulo_reunion,
                descripcion_reunion,
                fecha_reunion,
                hora_inicio_reunion,
                hora_fin_reunion,
                isRepetible,
                nombreSala,
                fechasRepetir
            };

            fetch('reuniones', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(envJson)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('data:', data);
                    obtenerReuniones();
                })
                .catch(error => {
                    console.error('Error:', error);
                });



        }
        function enviarInvitacion(idReunion) {
            const emailDiv = 'correoInv-' + idReunion;
            const correoInv = document.getElementById(emailDiv).value;
            const acompanantesInv = document.getElementById(`acompanantesInv-`+idReunion).value;

            const envJson = {
                idReunion,
                correoInv,
                acompanantesInv
                
            };

            fetch(`reuniones/invitacion`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(envJson)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('data:', data);
                    obtenerReuniones();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function detallesReunion(idReunion) {
            console.log('Detalles de la reunion:', idReunion);

        }
        function eliminarReunion(idReunion) {

        }

    </script>

</body>

</html>